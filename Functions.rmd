---
title: "Functions"
author: "Sophie Breitbart"
output: html_document
editor_options: 
  chunk_output_type: console
---

Outline:
- examples of homemade functions // 15-20 min
  - basic: exporting table, e.g.
    - write a function that makes a table
    * they make one
  - intermediate: nesting functions within functions
    - write a function that exports tables for each list item
    * they make one
  - advanced: scale up: ???????
    * they do this too
- Experimentation time // 5-10 min
  - include additional challenge for those who've finished other exercises
  - ** make breakout rooms based on skill level so they can chat with like-skilled participants? **
  
  
  
# Set up R markdown file
## Install packages 
```{r eval=FALSE}
# Install packages
install.packages("here")
```

## Load libraries & data
Quick aside on the genius of the <code>here()</code> package:


```{r message=FALSE}
# Load libraries
library(here)

# Make dataset from built-in dataset: "Body Temperature Series of Two Beavers"
beaver_1 <- beaver1
beaver_2 <- beaver2
```

# Functions: The Basics
## What is a function?

A function is a command that executes one to several tasks all at once. You've probably used functions before. In R, for example, we frequently use functions that have been made by other people: <code>read.csv()</code> and <code>print()</code> are functions, to name a few.


## When should we make our own functions?

In a 2016 [interview with Naturally Speaking](https://naturallyspeaking.blog/2016/06/22/episode-41-conversations-with-an-r-jedi/), Hadley Wickham explains,

> "A really good rule of thumb is, as soon as you've copied and pasted something more than twice, it's time to start thinking, 'how can I get rid of that duplication?'"

So if you think it wise to take the advice of RStudio's widely regarded Chief Scientist (which I certainly do!), then you should consider making your own functions when you find yourself copying and pasting something **3 or more times.**

There will always be times to break this rule, but here's Hadley again on why it's important to learn how to write your own functions:

> "Any time you've got duplication in your code, there's just a chance for... bugs to come in because... you change one, and you forget to change another one, you get inconsistencies. It's really frustrating."

# Exercises
## Goal 1: Make a function that exports a dataframe to csv
### How to set up a function
(assign it to a name, input variables, indenting, returns)
```{r}
Beaver_to_csv1.1 <- function(dataframe, filename) {
  write.csv(dataframe, file = filename)
}
```

### Example 1: Export beaver csv with only filename in path
```{r}
### make filename
filename1.1 <- "Beaver1.csv"

### Export df to csv
Beaver_to_csv1.1(beaver_1, filename1.1)
```

### Example 2: Export beaver csv with only filename in path
```{r}
### Make folder expecially for beaver files (make "exports" folder)

### Make new path 
path1.2 <- here::here("./exports/ ") ##### Can't figure out how to export without a space in the filepath so I'm adding on here and later getting rid of it with gsub

### Make new filename and type: separate name from type
filename1.2 <- "Beaver1"
filetype1.2 <- ".csv"

### Make function that exports df to csv in csvs folder
#### adding extra piece: filetype. We'll use .csv but could use .txt if wanted, etc.
##### Talk through function, esp. new gsub step
Beaver_to_csv1.2 <- function(dataframe, path, filename, filetype) {
  write.csv(dataframe,
            gsub(" ", "",
                 paste0(path, filename, filetype)))
}
  
### Export df to csv in csvs folder
Beaver_to_csv1.2(beaver_1, path1.2, filename1.2, filetype1.2)

#### Just for fun, add .txt as an option
Beaver_to_csv1.2(beaver_1, path1.2, filename1.2, ".txt")

#### Futhermore, we could skip the step of saving the function components to individual variables and could input it all on the fly here
Beaver_to_csv1.2(dataframe = beaver_1,
                 path = here::here("./exports/ "),
                 filename = "Beaver1",
                 filetype = ".txt")

#### You don't need the "x =" portion either... just helps clarify things
Beaver_to_csv1.2(beaver_1,
                 here::here("./exports/ "),
                 "Beaver1",
                 ".csv")
```


## Goal 2: Make a function that exports a list of dataframes to separate csvs
```{r}
# Make list of beaver dataframes
Beavers <- list(beaver_1, beaver_2)

# Export list of beaver dfs
Export_beaver_list <- function(df_list, path, filetype) {
  for (i in 1:length(df_list)){
    Beaver_to_csv1.2(df_list[i], path, paste0("Beaver", i), filetype)
  }
}

Export_beaver_list(Beavers, 
                   here::here("./exports/ "),
                   ".csv")
```

## Goal 3: Make, export plots for multiple dataframes
```{r}
# Regular plot 1
plot(beaver_1$temp ~ beaver_1$time,
     xlim = c(0, 2400),
     ylim = c(36, 38),
     xlab = "Time of Day",
     ylab = "Beaver Temperature (C)",
     col = "dark green",
     pch = 2,
     cex = .5)


# Making plot more easily reproducible by naming relative axis limits (vs absolute, for instance)
plot(temp ~ time,
     data = beaver_1,
     xlim = c(min(time),
              max(time)),
     ylim = c(min(temp) - 0.5,
              max(temp) + 0.5),
     xlab = "Time of Day",
     ylab = "Beaver Temperature (C)",
     col = "dark green",
     pch = 2, # point shape
     cex = .5) # point size


# Make function that uses a df as input and makes, then exports plot
Beaver_to_plot <- function(dataframe, path, filename, filetype) {
  
  png(file = gsub(" ", "",
                 paste0(path, filename, filetype)))
  
  plot(temp ~ time,
       data = dataframe,
       xlim = c(min(time),
                max(time)),
       ylim = c(min(temp) - 0.5,
                max(temp) + 0.5),
       xlab = "Time of Day",
       ylab = "Beaver Temperature (C)",
       col = "dark green",
       pch = 2, # point shape
       cex = .5) # point size
  
  dev.off() # tells R to stop plotting
  
}

Beaver_to_plot(beaver_1,
               here::here("./exports/ "),
               "Beaver1.1",
               ".png")


# Scale up: Do this for list of dataframes
Beaver_to_plot_many <- function(df_list, path, filetype) {
  for (i in 1:length(df_list)){
    Beaver_to_plot(df_list[[i]],
                   path,
                   paste0("Beaver", i, "_plot2"),
                   filetype)
  }
}


Beaver_to_plot_many(Beavers,
                    here::here("./exports/ "),
                    ".png")

```

