---
title: "Functions"
author: "Sophie Breitbart"
output: html_document
---


Goals:
- use as few packages as possible
- 30 minutes

Outline:
- *HAVE THEM SET UP A PROJECT AND SET WD? OTHERWISE IDK IF HERE:HERE WILL WORK*
- function basics // 5 min
  - what is a function?
  -   we use them all the time when they're made by other people
  - when should we make our own?
    - Hadley's golden rule: whenever you otherwise copy/paste something >3x (but there are exceptions of course)
- examples of homemade functions // 15-20 min
  - basic: exporting table, e.g.
    - write a function that makes a table
    * they make one
  - intermediate: nesting functions within functions
    - write a function that exports tables for each list item
    * they make one
  - advanced: scale up: ???????
    * they do this too
- Experimentation time // 5-10 min
  - include additional challenge for those who've finished other exercises
  - ** make breakout rooms based on skill level so they can chat with like-skilled participants? **
  
  
  
# Install packages and load libraries
```{r}
# Install packages
install.packages("here")

# Load libraries
## explain genuis behind "here" package
library(here)

# Make dataset from built-in dataset: "Body Temperature Series of Two Beavers""
beaver_1 <- beaver1
beaver_2 <- beaver2
```

# Functions: The Basics
## Goal 1: Make a function that exports a dataframe to csv
```{r}
## go over basic setup of function (assign it to a name, input variables, indenting, returns)
Beaver_to_csv1.1 <- function(dataframe, filename) {
  write.csv(dataframe, file = filename)
}

## Example 1: Export beaver csv with only filename in path
### make filename
filename1.1 <- "Beaver1.csv"

### Export df to csv
#### Talk through function,
Beaver_to_csv1.1(beaver_1, filename1.1)

## Example 2: Export beaver csv with only filename in path
### Make folder expecially for beaver files (make "exports" folder)
### Make new path 
path1.2 <- here::here("./exports/ ") ##### Can't figure out how to export without a space in the filepath so I'm adding on here and later getting rid of it with gsub
### Make new filename and type: separate name from type
filename1.2 <- "Beaver1"
filetype1.2 <- ".csv"

### Make function that exports df to csv in csvs folder
#### adding extra piece: filetype. We'll use .csv but could use .txt if wanted, etc.
##### Talk through function, esp. new gsub step
Beaver_to_csv1.2 <- function(dataframe, path, filename, filetype) {
  write.csv(dataframe,
            gsub(" ", "",
                 paste0(path, filename, filetype)))
}
  
### Export df to csv in csvs folder
Beaver_to_csv1.2(beaver_1, path1.2, filename1.2, filetype1.2)
#### Just for fun, add .txt as an option
Beaver_to_csv1.2(beaver_1, path1.2, filename1.2, ".txt")
#### Futhermore, we could skip the step of saving the function components to individual variables and could input it all on the fly here
Beaver_to_csv1.2(dataframe = beaver_1,
                 path = here::here("./exports/ "),
                 filename = "Beaver1",
                 filetype = ".txt")
#### You don't need the "x =" portion either... just helps clarify things
Beaver_to_csv1.2(beaver_1,
                 here::here("./exports/ "),
                 "Beaver1",
                 ".csv")
```

## Goal 2: Make a function that exports a list of dataframes to separate csvs
```{r}
# Make list of beaver dataframes
Beavers <- list(beaver_1, beaver_2)

# Export list of beaver dfs
Export_beaver_list <- function(df_list, path, filetype) {
  for (i in 1:length(df_list)){
    Beaver_to_csv1.2(df_list[i], path, paste0("Beaver", i), filetype)
  }
}

Export_beaver_list(Beavers, 
                   here::here("./exports/ "),
                   ".csv")
```

## Goal 3: Make, export plots for multiple dataframes
```{r}
# Regular plot 1
plot(beaver_1$temp ~ beaver_1$time,
     xlim = c(0, 2400),
     ylim = c(36, 38),
     xlab = "Time of Day",
     ylab = "Beaver Temperature (C)",
     col = "dark green",
     pch = 2,
     cex = .5)


# Making plot more easily reproducible by naming relative axis limits (vs absolute, for instance)
plot(temp ~ time,
     data = beaver_1,
     xlim = c(min(time),
              max(time)),
     ylim = c(min(temp) - 0.5,
              max(temp) + 0.5),
     xlab = "Time of Day",
     ylab = "Beaver Temperature (C)",
     col = "dark green",
     pch = 2, # point shape
     cex = .5) # point size


# Make function that uses a df as input and makes, then exports plot
Beaver_to_plot <- function(dataframe, path, filename, filetype) {
  
  png(file = gsub(" ", "",
                 paste0(path, filename, filetype)))
  
  print(plot(temp ~ time,
       data = dataframe,
       xlim = c(min(time),
                max(time)),
       ylim = c(min(temp) - 0.5,
                max(temp) + 0.5),
       xlab = "Time of Day",
       ylab = "Beaver Temperature (C)",
       col = "dark green",
       pch = 2, # point shape
       cex = .5)) # point size
  
  dev.off() # tells R to stop plotting
  
}

Beaver_to_plot(beaver_1,
               here::here("./exports/ "),
               "Beaver1.1",
               ".png")


# Scale up: Do this for list of dataframes
Beaver_to_plot_many <- function(df_list, path, filetype) {
  for (i in 1:length(df_list)){
    Beaver_to_plot(df_list[i],
                   path,
                   paste0("Beaver", i, "_plot2"),
                   filetype)
  }
}


############################################################
########## THIS ISN'T WORKING... FIX? OR REPLACE? ##########
############################################################

Beaver_to_plot_many(Beavers,
                    here::here("./exports/ "),
                    ".png")

```

